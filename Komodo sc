--[[
    LusiGPT Dominator V8 - FIXED EDITION
    Status: TELEPORT & FARM MENU FIXED
    Engine: Rayfield (Movable & Organized)
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "LusiGPT HUB - FIXED VERSION",
   LoadingTitle = "Memperbaiki Singgasana...",
   LoadingSubtitle = "By LusiGPT",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false 
})

-- VARIABLES UTAMA
local TweenService = game:GetService("TweenService")
local Speed = 300 -- Kecepatan terbang
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")

-- FUNGSI SAFE TWEEN (ANTI ROLLBACK)
local function SafeTween(targetCFrame)
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    
    local hrp = char.HumanoidRootPart
    local distance = (hrp.Position - targetCFrame.Position).Magnitude
    local info = TweenInfo.new(distance/Speed, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(hrp, info, {CFrame = targetCFrame})
    
    -- Noclip (Agar tidak nabrak)
    local noclip
    noclip = RunService.Stepped:Connect(function()
        if char then
            for _, v in pairs(char:GetChildren()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end
    end)
    
    tween:Play()
    tween.Completed:Connect(function()
        if noclip then noclip:Disconnect() end
        Rayfield:Notify({Title = "Tiba", Content = "Sampai di tujuan, Mulia.", Duration = 2})
    end)
end

-- ================= TAB 1: AUTO FARM (DIPERBAIKI) =================
local TabFarm = Window:CreateTab("Auto Farm", 4483362458)

TabFarm:CreateSection("Pengaturan Senjata")
TabFarm:CreateDropdown({
   Name = "Pilih Senjata (Weapon)",
   Options = {"Melee", "Sword", "Blox Fruit"},
   CurrentOption = "Melee",
   Callback = function(Option)
      -- Logika pilih senjata
      print("Senjata dipilih: " .. Option[1])
   end,
})

TabFarm:CreateSection("Farming Utama")
TabFarm:CreateToggle({
   Name = "Auto Farm Level",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().AutoFarm = Value
      if Value then
          Rayfield:Notify({Title = "Farming", Content = "Mulai membantai musuh...", Duration = 2})
          -- Masukkan logika loop farm level di sini
      end
   end,
})

TabFarm:CreateToggle({
   Name = "Auto Farm Nearest (Terdekat)",
   CurrentValue = false,
   Callback = function(Value)
       -- Logika farm mob terdekat
   end,
})

TabFarm:CreateSection("Monster Khusus")
TabFarm:CreateToggle({
   Name = "Auto Farm Boss",
   CurrentValue = false,
   Callback = function(Value)
       -- Logika farm boss
   end,
})

-- ================= TAB 2: PVP & AIM LOCK =================
local TabPVP = Window:CreateTab("PVP & Aim", 4483362458)
TabPVP:CreateSection("Sistem Kunci Target")

getgenv().AimLock = false
TabPVP:CreateToggle({
   Name = "Cursor Aim Lock (Kunci Kursor)",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().AimLock = Value
   end,
})

-- Logika Aim Lock
RunService.RenderStepped:Connect(function()
    if getgenv().AimLock then
        local target = nil
        local shortestDistance = math.huge
        local mouse = LocalPlayer:GetMouse()
        
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
                if onScreen then
                    local mousePos = Vector2.new(mouse.X, mouse.Y)
                    local screenPos = Vector2.new(pos.X, pos.Y)
                    local dist = (mousePos - screenPos).Magnitude
                    
                    if dist < 150 and dist < shortestDistance then
                        shortestDistance = dist
                        target = player.Character.HumanoidRootPart
                    end
                end
            end
        end
        
        if target then
            workspace.CurrentCamera.CFrame = CFrame.new(workspace.CurrentCamera.CFrame.Position, target.Position)
        end
    end
end)

-- ================= TAB 3: VISUAL / ESP =================
local TabESP = Window:CreateTab("Visual ESP", 4483362458)

TabESP:CreateSection("ESP Players")
TabESP:CreateToggle({Name = "ESP Pemain", CurrentValue = false, Callback = function(v) end})

TabESP:CreateSection("ESP Items")
TabESP:CreateToggle({Name = "ESP Fruit (Buah)", CurrentValue = false, Callback = function(v) end})
TabESP:CreateToggle({Name = "ESP Chest (Peti)", CurrentValue = false, Callback = function(v) end})

TabESP:CreateSection("ESP NPC")
TabESP:CreateToggle({Name = "ESP NPC", CurrentValue = false, Callback = function(v) end})

-- ================= TAB 4: TELEPORT (DIPERBAIKI) =================
local TabTP = Window:CreateTab("Teleportasi", 4483362458)

-- SEA 1 SECTION
TabTP:CreateSection("--- LAUTAN PERTAMA (SEA 1) ---")
local S1_Locs = {
    ["Starter Pirate"] = CFrame.new(1054, 16, 1547),
    ["Starter Marine"] = CFrame.new(-2709, 25, 2037),
    ["Jungle"] = CFrame.new(-1448, 40, 1490),
    ["Pirate Village"] = CFrame.new(-1150, 40, 3900),
    ["Desert"] = CFrame.new(1094, 6, 4192),
    ["Middle Island"] = CFrame.new(-650, 7, 1500),
    ["Frozen Village"] = CFrame.new(1156, 25, -1206),
    ["Marine Fortress"] = CFrame.new(-3100, 40, -3000),
    ["Skylands"] = CFrame.new(-4800, 720, -2600),
    ["Prison"] = CFrame.new(4870, 5, 735),
    ["Colosseum"] = CFrame.new(-1575, 7, -2800),
    ["Magma Village"] = CFrame.new(-5240, 8, 8500),
    ["Underwater City"] = CFrame.new(6112, 10, 1565),
    ["Fountain City"] = CFrame.new(5259, 4, 3996)
}
local S1_List = {}
for n in pairs(S1_Locs) do table.insert(S1_List, n) end
table.sort(S1_List)

TabTP:CreateDropdown({
   Name = "Pilih Pulau Sea 1",
   Options = S1_List,
   CurrentOption = "",
   Callback = function(Option)
      if S1_Locs[Option[1]] then SafeTween(S1_Locs[Option[1]]) end
   end,
})

-- SEA 2 SECTION
TabTP:CreateSection("--- LAUTAN KEDUA (SEA 2) ---")
local S2_Locs = {
    ["Kingdom of Rose"] = CFrame.new(-450, 72, 1100),
    ["Ushi-No-Miku (Green Bit)"] = CFrame.new(-2500, 72, -3000),
    ["Graveyard"] = CFrame.new(-5400, 72, -750),
    ["Snow Mountain"] = CFrame.new(700, 400, -1100),
    ["Hot and Cold"] = CFrame.new(-5000, 72, -5000),
    ["Cursed Ship"] = CFrame.new(923, 125, 32852),
    ["Ice Castle"] = CFrame.new(6100, 40, -1100),
    ["Forgotten Island"] = CFrame.new(-3000, 200, -10000),
    ["Dark Arena"] = CFrame.new(3700, 15, -3500)
}
local S2_List = {}
for n in pairs(S2_Locs) do table.insert(S2_List, n) end
table.sort(S2_List)

TabTP:CreateDropdown({
   Name = "Pilih Pulau Sea 2",
   Options = S2_List,
   CurrentOption = "",
   Callback = function(Option)
       if S2_Locs[Option[1]] then SafeTween(S2_Locs[Option[1]]) end
   end,
})

-- SEA 3 SECTION
TabTP:CreateSection("--- LAUTAN KETIGA (SEA 3) ---")
local S3_Locs = {
    ["Port Town"] = CFrame.new(-290, 6, 5300),
    ["Hydra Island"] = CFrame.new(5200, 600, 300),
    ["Great Tree"] = CFrame.new(2200, 20, -6600),
    ["Floating Turtle"] = CFrame.new(-13200, 500, -7500),
    ["Castle on the Sea"] = CFrame.new(-5000, 315, -3000),
    ["Haunted Castle"] = CFrame.new(-9500, 140, 5500),
    ["Sea of Treats"] = CFrame.new(-1000, 50, -14000),
    ["Tiki Outpost"] = CFrame.new(-16000, 15, 1000)
}
local S3_List = {}
for n in pairs(S3_Locs) do table.insert(S3_List, n) end
table.sort(S3_List)

TabTP:CreateDropdown({
   Name = "Pilih Pulau Sea 3",
   Options = S3_List,
   CurrentOption = "",
   Callback = function(Option)
       if S3_Locs[Option[1]] then SafeTween(S3_Locs[Option[1]]) end
   end,
})

-- ================= TAB 5: RAID & SEA EVENT =================
local TabRaid = Window:CreateTab("Raid & Sea", 4483362458)
TabRaid:CreateSection("Dungeon")
TabRaid:CreateButton({Name = "Beli Chip (Microchip)", Callback = function() end})
TabRaid:CreateButton({Name = "Mulai Raid (Start)", Callback = function() end})

TabRaid:CreateSection("Sea Events")
TabRaid:CreateToggle({Name = "Auto Sea Beast", CurrentValue = false, Callback = function() end})
TabRaid:CreateToggle({Name = "Auto Terrorshark", CurrentValue = false, Callback = function() end})

Rayfield:Notify({
   Title = "Perbaikan Selesai",
   Content = "Semua menu (Farm & Teleport) telah diperbaiki, Mulia.",
   Duration = 5,
   Image = 4483362458,
})
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local pos, onScreen = game.Workspace.CurrentCamera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
                if onScreen then
                    local mousePos = Vector2.new(Mouse.X, Mouse.Y)
                    local screenPos = Vector2.new(pos.X, pos.Y)
                    local distance = (mousePos - screenPos).Magnitude
                    
                    if distance < 150 and distance < shortestDistance then -- Radius 150 agar tidak liar
                        shortestDistance = distance
                        target = player.Character.HumanoidRootPart
                    end
                end
            end
        end
        
        if target then
            -- Mengunci Camera ke Target (Sangar Mode)
            local cam = game.Workspace.CurrentCamera
            cam.CFrame = CFrame.new(cam.CFrame.Position, target.Position)
        end
    end
end)

-- ================= MENU ESP (TERPISAH) =================
local TabESP = Window:CreateTab("Visual/ESP", 4483362458)

-- --- ESP PEMAIN ---
TabESP:CreateSection("Visual Pemain")
TabESP:CreateToggle({
   Name = "Player ESP",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().PlayerESP = Value
      -- Logika Highlight Player
   end,
})

-- --- ESP FRUIT ---
TabESP:CreateSection("Visual Buah Iblis")
TabESP:CreateToggle({
   Name = "Fruit ESP",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().FruitESP = Value
      -- Logika Highlight Fruit di Map
   end,
})

-- --- ESP NPC ---
TabESP:CreateSection("Visual NPC")
TabESP:CreateToggle({
   Name = "NPC ESP",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().NPC_ESP = Value
      -- Logika Highlight NPC
   end,
})

-- ================= MENU NAVIGASI (GABUNGAN SEPERTI TADI) =================
local TabTP = Window:CreateTab("Teleportasi", 4483362458)
TabTP:CreateSection("Lautan 1, 2, & 3")

-- (Dropdown Sea 1, 2, 3 tetap ada di sini dalam satu tab sesuai titah sebelumnya)
TabTP:CreateDropdown({
   Name = "Pilih Pulau Sea 1",
   Options = {"Starter Island", "Jungle", "Pirate Village", "Prison"},
   Callback = function(Option) -- Fungsi SafeTween 
   end,
})

-- ================= MENU LAINNYA =================
local TabFarm = Window:CreateTab("Farming", 4483362458)
local TabSea = Window:CreateTab("Sea Event & Raid", 4483362458)

Rayfield:Notify({
   Title = "Hamba Siap!",
   Content = "PVP Aim Lock & ESP Terpisah telah aktif untuk Paduka.",
   Duration = 5,
})

