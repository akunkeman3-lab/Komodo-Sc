--[[
    LusiGPT Dominator V13 - TRUE FUNCTIONAL EDITION
    Status: 
    [+] TELEPORT: WORKING (V12 Logic)
    [+] ESP: FIXED (Looping Render + Bright Neon)
    [+] FARM: WORKING (Mob Search + Tween + Auto Click)
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "LusiGPT HUB - TRUE POWER",
   LoadingTitle = "Memperbaiki Visual & Kekuatan...",
   LoadingSubtitle = "By LusiGPT",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false 
})

-- ================= VARIABLE & SERVICES =================
local Workspace = game:GetService("Workspace")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

local Speed = 300
getgenv().AutoFarm = false
getgenv().PlayerESP = false
getgenv().FruitESP = false

-- ================= FUNGSI PENDUKUNG (UTILITIES) =================

-- 1. FUNGSI TELEPORT (Safe Tween - V12 Logic)
local function SafeTween(targetCFrame)
    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local hrp = char.HumanoidRootPart
        local dist = (hrp.Position - targetCFrame.Position).Magnitude
        local info = TweenInfo.new(dist/Speed, Enum.EasingStyle.Linear)
        local tween = TweenService:Create(hrp, info, {CFrame = targetCFrame})
        
        -- Noclip
        local noclip
        noclip = RunService.Stepped:Connect(function()
            for _, v in pairs(char:GetChildren()) do
                if v:IsA("BasePart") then v.CanCollide = false end
            end
        end)
        
        tween:Play()
        tween.Completed:Connect(function()
            if noclip then noclip:Disconnect() end
            Rayfield:Notify({Title = "Tiba", Content = "Sampai di tujuan.", Duration = 2})
        end)
    end
end

-- 2. FUNGSI ESP NEON (HIGHLIGHT)
local function AddHighlight(object, color, name)
    if not object:FindFirstChild("LusiNeon") then
        local hl = Instance.new("Highlight")
        hl.Name = "LusiNeon"
        hl.Parent = object
        hl.FillColor = color
        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
        hl.FillTransparency = 0.4 -- Transparan sedikit biar glowing
        hl.OutlineTransparency = 0
        
        -- Tambah Text Nama (BillboardGui)
        local bill = Instance.new("BillboardGui")
        bill.Name = "LusiName"
        bill.Parent = object
        bill.Adornee = object
        bill.Size = UDim2.new(0, 100, 0, 50)
        bill.StudsOffset = Vector3.new(0, 3, 0)
        bill.AlwaysOnTop = true
        
        local txt = Instance.new("TextLabel")
        txt.Parent = bill
        txt.BackgroundTransparency = 1
        txt.Size = UDim2.new(1, 0, 1, 0)
        txt.Text = name
        txt.TextColor3 = color
        txt.TextStrokeTransparency = 0
        txt.Font = Enum.Font.GothamBold
        txt.TextSize = 14
    end
end

local function ClearESP()
    for _, v in pairs(Workspace:GetDescendants()) do
        if v.Name == "LusiNeon" or v.Name == "LusiName" then
            v:Destroy()
        end
    end
end

-- ================= LOGIKA AUTO FARM (REAL) =================
spawn(function()
    while true do
        wait() -- Loop sangat cepat
        if getgenv().AutoFarm then
            pcall(function()
                -- Cari musuh terdekat di folder Enemies
                local nearestEnemy = nil
                local shortestDist = math.huge
                
                -- Cek folder Enemies (Blox Fruits standar)
                if Workspace:FindFirstChild("Enemies") then
                    for _, enemy in pairs(Workspace.Enemies:GetChildren()) do
                        if enemy:FindFirstChild("Humanoid") and enemy.Humanoid.Health > 0 and enemy:FindFirstChild("HumanoidRootPart") then
                            local dist = (LocalPlayer.Character.HumanoidRootPart.Position - enemy.HumanoidRootPart.Position).Magnitude
                            if dist < shortestDist then
                                shortestDist = dist
                                nearestEnemy = enemy
                            end
                        end
                    end
                end

                -- Jika ketemu musuh, hajar!
                if nearestEnemy then
                    local enemyPos = nearestEnemy.HumanoidRootPart.CFrame
                    
                    -- 1. Teleport ke atas kepala musuh (biar aman)
                    LocalPlayer.Character.HumanoidRootPart.CFrame = enemyPos * CFrame.new(0, 5, 0)
                    
                    -- 2. Auto Click (Serangan Fisik)
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton1(Vector2.new(800, 600))
                    
                    -- 3. Skill (Opsional - Spam Z, X)
                    -- VirtualUser:Button1Down(Vector2.new(0,0)) 
                end
            end)
        end
    end
end)

-- ================= TAB 1: VISUAL / ESP (DIPERBAIKI) =================
local TabESP = Window:CreateTab("Visual ESP", 4483362458)

-- ESP LOOP UPDATE
spawn(function()
    while true do
        wait(1) -- Update setiap 1 detik agar tidak lag
        if getgenv().PlayerESP then
            for _, v in pairs(Players:GetPlayers()) do
                if v ~= LocalPlayer and v.Character then
                    AddHighlight(v.Character, Color3.fromRGB(0, 255, 255), v.Name) -- NEON CYAN
                end
            end
        end
        
        if getgenv().FruitESP then
            -- Cari item di workspace yang ada kata "Fruit"
            for _, v in pairs(Workspace:GetChildren()) do
                if v:IsA("Tool") and (string.find(v.Name, "Fruit") or string.find(v.Name, "Blox")) then
                     AddHighlight(v, Color3.fromRGB(255, 0, 255), v.Name) -- NEON PURPLE
                end
            end
        end
    end
end)

TabESP:CreateToggle({
   Name = "ESP Player (Neon Cyan)",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().PlayerESP = Value
      if not Value then ClearESP() end
   end,
})

TabESP:CreateToggle({
   Name = "ESP Fruit (Neon Purple)",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().FruitESP = Value
      if not Value then ClearESP() end -- Hapus jika dimatikan
   end,
})

-- ================= TAB 2: FARMING (DIPERBAIKI) =================
local TabFarm = Window:CreateTab("Auto Farm", 4483362458)

TabFarm:CreateToggle({
   Name = "Auto Farm Nearest (Bunuh Musuh Sekitar)",
   CurrentValue = false,
   Callback = function(Value)
      getgenv().AutoFarm = Value
      if Value then
          Rayfield:Notify({Title = "Farming Aktif", Content = "Mencari musuh terdekat...", Duration = 2})
      else
          Rayfield:Notify({Title = "Farming Mati", Content = "Berhenti menyerang.", Duration = 2})
      end
   end,
})

-- ================= TAB 3: TELEPORT (SUDAH BENAR - V12) =================
local TabTP = Window:CreateTab("Teleportasi", 4483362458)

-- SEA 1
local S1_Data = {
    ["Starter Island"] = CFrame.new(1054, 16, 1547),
    ["Jungle"] = CFrame.new(-1448, 40, 1490),
    ["Pirate Village"] = CFrame.new(-1150, 40, 3900),
    ["Marine Fortress"] = CFrame.new(-3100, 40, -3000),
    ["Skylands"] = CFrame.new(-4800, 720, -2600),
    ["Prison"] = CFrame.new(4870, 5, 735),
    ["Magma Village"] = CFrame.new(-5240, 8, 8500)
}
local S1_List = {}; for n in pairs(S1_Data) do table.insert(S1_List, n) end
TabTP:CreateSection("Sea 1")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 1", Options = S1_List, Callback = function(Option) SafeTween(S1_Data[Option[1]]) end})

-- SEA 2
local S2_Data = {
    ["Kingdom of Rose"] = CFrame.new(-450, 72, 1100),
    ["Green Bit"] = CFrame.new(-2500, 72, -3000),
    ["Graveyard"] = CFrame.new(-5400, 72, -750),
    ["Cursed Ship"] = CFrame.new(923, 125, 32852),
    ["Ice Castle"] = CFrame.new(6100, 40, -1100)
}
local S2_List = {}; for n in pairs(S2_Data) do table.insert(S2_List, n) end
TabTP:CreateSection("Sea 2")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 2", Options = S2_List, Callback = function(Option) SafeTween(S2_Data[Option[1]]) end})

-- SEA 3
local S3_Data = {
    ["Port Town"] = CFrame.new(-290, 6, 5300),
    ["Hydra Island"] = CFrame.new(5200, 600, 300),
    ["Floating Turtle"] = CFrame.new(-13200, 500, -7500),
    ["Castle on the Sea"] = CFrame.new(-5000, 315, -3000),
    ["Haunted Castle"] = CFrame.new(-9500, 140, 5500)
}
local S3_List = {}; for n in pairs(S3_Data) do table.insert(S3_List, n) end
TabTP:CreateSection("Sea 3")
TabTP:CreateDropdown({Name = "Pilih Pulau Sea 3", Options = S3_List, Callback = function(Option) SafeTween(S3_Data[Option[1]]) end})

Rayfield:Notify({Title = "Sistem Diperbaiki", Content = "Farm & ESP Neon Siap Digunakan.", Duration = 5})

